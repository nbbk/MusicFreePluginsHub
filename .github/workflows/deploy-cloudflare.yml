name: Daily Sync and Deploy to Cloudflare Pages

on:
  schedule:
    - cron: "0 17 * * *"  # 每天 UTC 17:00 运行 (北京时间 1:00)
  workflow_dispatch:  # 允许手动触发

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Sync with upstream repository (optional, only if you're working with a fork)
      - name: Sync with upstream repository
        run: |
          git remote add upstream https://github.com/UPSTREAM_OWNER/UPSTREAM_REPO.git
          git fetch upstream
          git checkout main
          git merge upstream/main

      # Set up Node.js (for deploying with Cloudflare Pages)
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'

      # Install dependencies (if necessary)
      - name: Install dependencies
        run: |
          npm install

      # Build the project (adjust if needed)
      - name: Build project
        run: |
          npm run build

      # Deploy to Cloudflare Pages
      - name: Deploy to Cloudflare Pages
        env:
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}  # 使用你的 Cloudflare API Token
        run: |
          curl -X POST https://api.cloudflare.com/client/v4/accounts/YOUR_ACCOUNT_ID/pages/projects/YOUR_PROJECT_NAME/deployments \
            -H "Authorization: Bearer $CF_API_TOKEN" \
            -F "branch=main" \
            -F "metadata[deploy_env]=production"
